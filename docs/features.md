# 기능 상세 가이드

## 1. 방 생성 및 입장

### 방 생성
- **방식**: 메인 페이지에서 "방 생성하기" 버튼 클릭
- **ID 형식**: 8자리 nanoid (예: `AbC123Xy`)
- **장점**: UUID 대비 짧고 사용자 친화적, URL-safe 문자만 사용

### 방 입장 방법
1. **QR 코드 스캔**: "QR 스캔" 버튼으로 카메라를 통한 QR 코드 인식
2. **방 ID 직접 입력**: "방 ID 입력" 버튼으로 8자리 ID를 직접 입력
3. **URL 접근**: `/room/:id` 형태의 URL로 직접 접근

## 2. Tab BPM 기능

### 사용법
1. 방에 입장한 후 "Tab" 버튼을 원하는 박자에 맞춰 연속으로 클릭
2. 최소 2번 이상 탭해야 BPM 계산 시작
3. 최근 4번의 탭 간격으로 평균 BPM 계산
4. 계산된 BPM이 자동으로 메트로놈에 적용

### 특징
- **정확도**: 최근 4번 탭의 평균 간격으로 계산하여 안정적
- **범위 제한**: 40-240 BPM 범위 내로 자동 제한
- **초기화**: "초기화" 버튼으로 탭 기록 삭제 가능
- **실시간 반영**: 탭할 때마다 즉시 BPM 변경 및 동기화

## 3. 자연스러운 BPM 변경

### 기존 문제점
- BPM 변경 시 메트로놈이 처음부터 다시 시작
- 박자 위치가 리셋되어 불연속적인 느낌

### 개선된 방식
- **박자 유지**: 현재 박자 위치를 그대로 유지
- **간격 조정**: 박자 간의 시간 간격만 변경
- **서버 동기화**: 서버에서 시작 시간을 재계산하여 모든 클라이언트에 동기화

### 기술적 구현
```go
// 서버 측: BPM 변경 시 시작 시간 재계산
elapsedTime := now - state.StartTime
secondsPerBeatOld := 60.0 / float64(state.Tempo)
elapsedBeats := float64(elapsedTime) / 1000.0 / secondsPerBeatOld
secondsPerBeatNew := 60.0 / float64(tempo)
newStartTime := now - int64(elapsedBeats*secondsPerBeatNew*1000.0)
```

## 4. 사운드 미리 로딩

### 구현 방식
- **자동 로딩**: 방 입장 시 메트로놈 클래스 초기화와 동시에 사운드 로드
- **파일 경로**: `/sounds/click.mp3` (일반 박자), `/sounds/accent.mp3` (강박)
- **에러 처리**: 사운드 로드 실패 시 콘솔에 에러 로그 출력

### 장점
- **즉시 재생**: 재생 버튼 클릭 시 지연 없이 바로 소리 재생
- **사용자 경험**: 로딩 대기 시간 없이 부드러운 사용 경험

## 5. 실시간 동기화

### 동기화 메커니즘
1. **서버 시간 기준**: 서버의 `serverTime`을 기준으로 동기화
2. **오프셋 계산**: 클라이언트와 서버 간의 시간 차이 계산
3. **주기적 보정**: 3초마다 서버에서 동기화 신호 전송
4. **박자 정확도**: 밀리초 단위의 정확한 박자 동기화

### WebSocket 메시지
```json
{
  "type": "metronomeState",
  "isPlaying": true,
  "tempo": 128,
  "beats": 4,
  "startTime": 1730000000000,
  "serverTime": 1730000000000,
  "roomUuid": "AbC123Xy"
}
```

## 6. 사용자 인터페이스

### 메인 페이지
- **방 생성**: 파란색 "방 생성하기" 버튼
- **QR 스캔**: 회색 "QR 스캔" 버튼
- **방 ID 입력**: 보라색 "방 ID 입력" 버튼

### 방 페이지
- **QR 표시**: 방 입장용 QR 코드와 URL 표시
- **메트로놈 컨트롤**: 시작/정지, BPM ScrollPicker, 박자 ScrollPicker
- **Tab 기능**: 파란색 "Tab" 버튼과 초기화 버튼

### 반응형 디자인
- **모바일 최적화**: 터치 친화적인 버튼 크기
- **접근성**: 키보드 네비게이션 지원
- **시각적 피드백**: 호버/액티브 상태 표시

## 7. ScrollPicker 시스템

### BPM ScrollPicker (세로)
- **범위**: 40-240 BPM, 1단위로 조정 가능
- **초기값**: 120 BPM
- **표시 개수**: 7개 (중앙 1개 + 위아래 각 3개)
- **중앙 정렬**: 선택된 값이 항상 중앙에 위치
- **자연스러운 애니메이션**: easeOutCubic 이징을 사용한 부드러운 스크롤
- **다양한 입력 방식**: 마우스 드래그, 터치 스와이프, 휠 스크롤 지원
- **실시간 동기화**: WebSocket을 통한 다중 클라이언트 동기화

### 박자 ScrollPicker (가로)
- **범위**: 2-8 박자, 1단위로 조정 가능
- **초기값**: 4 박자
- **표시 방식**: 가로 스크롤로 좌우 이동
- **전체 너비**: 부모 컨테이너의 전체 너비 활용
- **항목 배치**: Flexbox를 사용하여 겹치지 않는 자연스러운 배치
- **반응형**: 컨테이너 크기에 따라 동적으로 중앙 정렬

### 공통 사용자 경험
- **직관적 조작**: 스크롤하여 원하는 값 선택
- **시각적 피드백**: 선택된 값은 크고 굵게 표시, 거리에 따라 투명도와 크기 조절
- **터치 최적화**: 모바일에서 자연스러운 스와이프 조작
- **키보드 접근성**: 마우스 휠을 통한 정밀한 조정
- **일관된 디자인**: 동일한 스타일과 애니메이션 적용

## 8. 기술적 특징

### 프론트엔드
- **React 19**: 최신 React 기능 활용
- **Web Workers**: 안정적인 오디오 스케줄링
- **AudioContext**: 고품질 오디오 처리
- **PandaCSS**: 타입 안전한 스타일링
- **ScrollPicker 시스템**: 
  - 세로 ScrollPicker (BPM 선택)
  - 가로 HorizontalScrollPicker (박자 선택)
  - 공통 애니메이션 및 터치 지원

### 백엔드
- **Go 1.22**: 고성능 서버 구현
- **WebSocket**: 실시간 양방향 통신
- **MongoDB**: 방 정보 영구 저장
- **nanoid**: 짧고 안전한 ID 생성

### 성능 최적화
- **메모리 관리**: 사용하지 않는 방 자동 정리
- **연결 관리**: WebSocket 자동 재연결
- **오디오 최적화**: Web Worker를 통한 안정적인 타이밍
