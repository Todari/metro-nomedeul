# 기능 상세 가이드

## 1. 방 생성 및 입장

### 방 생성
- **방식**: 메인 페이지에서 "방 생성하기" 버튼 클릭
- **ID 형식**: 8자리 nanoid (예: `AbC123Xy`)
- **장점**: UUID 대비 짧고 사용자 친화적, URL-safe 문자만 사용

### 방 입장 방법
1. **QR 코드 스캔**: "QR 스캔" 버튼으로 카메라를 통한 QR 코드 인식
2. **방 ID 직접 입력**: "방 ID 입력" 버튼으로 8자리 ID를 직접 입력
3. **URL 접근**: `/room/:id` 형태의 URL로 직접 접근

## 2. Tab BPM 기능

### 사용법
1. 방에 입장한 후 "Tab" 버튼을 원하는 박자에 맞춰 연속으로 클릭
2. 최소 2번 이상 탭해야 BPM 계산 시작
3. 최근 4번의 탭 간격으로 평균 BPM 계산
4. 계산된 BPM이 자동으로 메트로놈에 적용

### 특징
- **정확도**: 최근 4번 탭의 평균 간격으로 계산하여 안정적
- **범위 제한**: 40-240 BPM 범위 내로 자동 제한
- **초기화**: "초기화" 버튼으로 탭 기록 삭제 가능
- **실시간 반영**: 탭할 때마다 즉시 BPM 변경 및 동기화

## 3. 자연스러운 BPM 변경

### 기존 문제점
- BPM 변경 시 메트로놈이 처음부터 다시 시작
- 박자 위치가 리셋되어 불연속적인 느낌

### 개선된 방식
- **박자 유지**: 현재 박자 위치를 그대로 유지
- **간격 조정**: 박자 간의 시간 간격만 변경
- **서버 동기화**: 서버에서 시작 시간을 재계산하여 모든 클라이언트에 동기화

### 기술적 구현
```go
// 서버 측: BPM 변경 시 시작 시간 재계산
elapsedTime := now - state.StartTime
secondsPerBeatOld := 60.0 / float64(state.Tempo)
elapsedBeats := float64(elapsedTime) / 1000.0 / secondsPerBeatOld
secondsPerBeatNew := 60.0 / float64(tempo)
newStartTime := now - int64(elapsedBeats*secondsPerBeatNew*1000.0)
```

## 4. Web Audio API 기반 사운드 생성

### 기존 문제점
- 오디오 파일 로딩으로 인한 지연 및 네트워크 의존성
- 파일 크기로 인한 초기 로딩 시간 증가
- 브라우저별 오디오 파일 호환성 문제

### 개선된 방식
- **프로그래밍적 생성**: Web Audio API를 사용하여 실시간으로 사운드 생성
- **즉시 재생**: 파일 로딩 없이 즉시 사운드 재생 가능
- **브라우저 호환성**: 모든 모던 브라우저에서 일관된 사운드 품질

### 기술적 구현
```typescript
// Web Audio API로 클릭 사운드 생성
private createClickSound(isAccent: boolean) {
  const oscillator = this.audioContext!.createOscillator();
  const gainNode = this.audioContext!.createGain();
  
  // 악센트와 일반 비트 구분
  const frequency = isAccent ? 1200 : 800; // Hz
  
  oscillator.frequency.setValueAtTime(frequency, this.audioContext!.currentTime);
  oscillator.type = 'sine';
  
  // Attack/Decay 효과
  gainNode.gain.setValueAtTime(0, this.audioContext!.currentTime);
  gainNode.gain.linearRampToValueAtTime(volume, this.audioContext!.currentTime + 0.01);
  gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext!.currentTime + 0.1);
  
  oscillator.connect(gainNode);
  gainNode.connect(this.audioContext!.destination);
  
  oscillator.start(this.audioContext!.currentTime);
  oscillator.stop(this.audioContext!.currentTime + 0.1);
}
```

### 장점
- **즉시 재생**: 파일 로딩 없이 즉시 사운드 재생 가능
- **네트워크 독립**: 인터넷 연결 없이도 사운드 재생
- **일관된 품질**: 브라우저 환경에 관계없이 동일한 사운드 품질

## 5. 고도화된 실시간 동기화

### 동기화 메커니즘
1. **서버 시간 기준**: 서버의 `serverTime`을 기준으로 동기화
2. **오프셋 계산**: 클라이언트와 서버 간의 시간 차이 계산
3. **주기적 보정**: 5초마다 서버에서 동기화 신호 전송 (안정성 향상)
4. **박자 정확도**: 밀리초 단위의 정확한 박자 동기화

### BPM 변경 시 동기화 개선
- **서버 중심 처리**: BPM 변경을 서버에서 처리하여 모든 클라이언트에 동시 전파
- **박자 위상 보존**: BPM 변경 시 현재 박자 위치를 정확히 유지
- **동기화 임계값 최적화**: 200ms 이상의 차이에서만 동기화 적용 (안정성 향상)
- **안전장치**: 2박자 이상의 큰 차이는 무시하여 네트워크 오류 방지

### 재생 중 설정 변경 방지 (v3.1)
- **문제**: 재생 중 BPM/박자 변경 시 클라이언트 간 불일치 발생
- **해결**: 재생 중에는 설정 변경을 완전히 차단
- **사용자 경험**: 설정 버튼 클릭 시 자동으로 메트로놈 정지 후 설정 변경 가능
- **서버 동기화**: 모든 클라이언트에서 동시에 메트로놈이 정지되어 일관성 보장

### WebSocket 메시지
```json
{
  "type": "metronomeState",
  "isPlaying": true,
  "tempo": 128,
  "beats": 4,
  "startTime": 1730000000000,
  "serverTime": 1730000000000,
  "roomUuid": "AbC123Xy"
}
```

## 6. 사용자 인터페이스

### 디자인 시스템
- **다크모드**: 기본적으로 어두운 배경과 밝은 텍스트
- **Primary 색상**: 오렌지 계열 (orange.600, orange.700, orange.800)
- **Secondary 색상**: 모노톤 그레이 계열 (neutral.600, neutral.700, neutral.800)
- **카드 디자인**: 둥근 모서리, 그림자 효과, 테두리 강조

### 메인 페이지
- **방 생성**: 오렌지 "방 생성하기" 버튼
- **QR 스캔**: 그레이 "QR 스캔" 버튼
- **방 ID 입력**: 그레이 "방 ID 입력" 버튼

### 방 페이지
- **전체 레이아웃**: 전체 화면 높이 활용 (100dvh)
- **헤더**: 상단 고정 헤더 컴포넌트
- **박자 카드**: 전체 화면 중앙에 현재 박자를 시각적으로 표시
  - 기본: 어두운 배경 (neutral.800)
  - 강박 (1번째): 흰색 배경 + 오렌지 테두리
  - 일반 박자: 회색 배경 (neutral.300)
  - 전체 화면 크기로 확장 (w: full, h: full)
- **QR 표시**: 현재 주석 처리 (추후 복원 예정)
- **메트로놈 컨트롤**: 
  - 현재 BPM과 박자 상태 표시
  - 오디오 초기화 버튼 (첫 진입 시)
  - 시작/정지 버튼 (오디오 준비 후)
  - 설정 버튼 (톱니바퀴 아이콘)
- **설정 바텀시트**: 설정 버튼 클릭 시 나타나는 하단 시트
  - BPM ScrollPicker (세로 스크롤)
  - 박자 HorizontalScrollPicker (가로 스크롤)
  - 탭 템포 버튼과 초기화 버튼
  - 오버레이와 닫기 버튼

### 반응형 디자인
- **모바일 최적화**: 터치 친화적인 버튼 크기
- **접근성**: 키보드 네비게이션 지원
- **시각적 피드백**: 호버/액티브 상태 표시
- **애니메이션**: 부드러운 전환 효과와 박자 깜빡임

## 7. ScrollPicker 시스템

### BPM ScrollPicker (세로)
- **범위**: 40-240 BPM, 1단위로 조정 가능
- **초기값**: 120 BPM
- **표시 개수**: 7개 (중앙 1개 + 위아래 각 3개)
- **중앙 정렬**: 선택된 값이 항상 중앙에 위치
- **자연스러운 애니메이션**: easeOutCubic 이징을 사용한 부드러운 스크롤
- **다양한 입력 방식**: 마우스 드래그, 터치 스와이프, 휠 스크롤 지원
- **실시간 동기화**: WebSocket을 통한 다중 클라이언트 동기화

### 박자 ScrollPicker (가로)
- **범위**: 2-8 박자, 1단위로 조정 가능
- **초기값**: 4 박자
- **표시 방식**: 가로 스크롤로 좌우 이동
- **전체 너비**: 부모 컨테이너의 전체 너비 활용
- **항목 배치**: Flexbox를 사용하여 겹치지 않는 자연스러운 배치
- **반응형**: 컨테이너 크기에 따라 동적으로 중앙 정렬

### 공통 사용자 경험
- **직관적 조작**: 스크롤하여 원하는 값 선택
- **시각적 피드백**: 선택된 값은 크고 굵게 표시, 거리에 따라 투명도와 크기 조절
- **터치 최적화**: 모바일에서 자연스러운 스와이프 조작
- **키보드 접근성**: 마우스 휠을 통한 정밀한 조정
- **일관된 디자인**: 동일한 스타일과 애니메이션 적용
- **다크모드 최적화**: 오렌지 계열 선택 영역, 밝은 텍스트

## 8. 박자 시각화

### BeatCard 컴포넌트
- **위치**: 방 페이지 전체 화면 중앙
- **크기**: 전체 화면 크기 (w: full, h: full)
- **레이아웃**: Flexbox 중앙 정렬로 박자 숫자 표시
- **기본 상태**: 어두운 배경 (neutral.800)에 흰색 텍스트
- **강박 표시**: 1번째 박자일 때 흰색 배경 + 오렌지 테두리
- **일반 박자**: 2번째 이후 박자일 때 회색 배경 (neutral.300)
- **애니메이션**: 200ms 동안 색상 변화 후 원래 색상으로 복귀
- **Props 변경**: totalBeats 제거, currentBeat와 isPlaying만 사용

### 박자 카운팅
- **실시간 업데이트**: BPM에 따른 정확한 간격으로 박자 카운트
- **마디 반복**: 설정된 박자 수에 도달하면 1로 리셋
- **시각적 피드백**: 각 박자마다 카드 색상 변화로 현재 위치 표시

## 9. 기술적 특징

### 프론트엔드
- **React 19**: 최신 React 기능 활용
- **Web Workers**: 안정적인 오디오 스케줄링
- **AudioContext**: 고품질 오디오 처리
- **PandaCSS**: 타입 안전한 스타일링
- **ScrollPicker 시스템**: 
  - 세로 ScrollPicker (BPM 선택)
  - 가로 HorizontalScrollPicker (박자 선택)
  - 공통 애니메이션 및 터치 지원
- **색상 시스템**: 
  - Primary: 오렌지 계열 (orange.400, orange.600, orange.700, orange.800)
  - Secondary: 중성 회색 계열 (neutral.300, neutral.600, neutral.700, neutral.800)
- **레이아웃**: 
  - 전체 화면 높이 활용 (100dvh)
  - Flexbox 기반 중앙 정렬
  - 반응형 디자인

### 백엔드
- **Go 1.22**: 고성능 서버 구현
- **WebSocket**: 실시간 양방향 통신
- **MongoDB**: 방 정보 영구 저장
- **nanoid**: 짧고 안전한 ID 생성

### 성능 최적화
- **메모리 관리**: 사용하지 않는 방 자동 정리
- **연결 관리**: WebSocket 자동 재연결
- **오디오 최적화**: Web Worker를 통한 안정적인 타이밍

## 10. 최근 변경사항 (v2.4)

### WebSocket 동기화 개선 - 안정성 강화
- **메시지 큐 시스템**: WebSocket 연결이 불안정할 때 메시지를 큐에 저장하고 연결되면 자동 전송
- **안전한 메시지 전송**: WebSocket 상태 확인 후 메시지 전송, 실패 시 큐에 저장
- **서버 상태 동기화**: 서버에서 받은 시작/정지 상태가 모든 클라이언트에 제대로 적용
- **오디오 초기화 개선**: 서버 상태 변경 시에도 오디오 초기화가 안전하게 처리
- **에러 처리 강화**: WebSocket 연결 오류와 메시지 전송 실패에 대한 상세한 로깅

#### 메시지 큐 관리 시스템
- **메모리 제한**: 최대 50개 메시지로 큐 크기 제한하여 메모리 사용량 제어
- **자동 정리**: 30초가 지난 오래된 메시지는 자동으로 제거
- **중복 제거**: 같은 액션의 메시지가 있으면 기존 것을 제거하고 최신 것만 유지
- **주기적 정리**: 10초마다 큐를 정리하여 메모리 누수 방지
- **스마트 전송**: 연결 복구 시 큐의 모든 메시지를 순서대로 안전하게 전송

### 기술적 개선사항
- **메시지 전송 분리**: 사용자 액션과 서버 상태 변경을 구분하여 처리
- **비동기 상태 처리**: 서버 상태 변경을 비동기로 안전하게 처리
- **연결 상태 관리**: WebSocket 재연결 중에도 메시지 손실 방지
- **타입 안전성**: TypeScript 타입 정의 개선으로 런타임 오류 방지

## 11. 이전 변경사항 (v2.3)

### 오디오 초기화/메트로놈 안정화
- 시작 버튼 클릭 시 자동 초기화(필요 시) 후 재생 시작
- 메트로놈 인스턴스를 WebSocket과 독립적으로 선생성, WebSocket은 주입 방식으로 교체
- WebSocket 리스너 중복 제거로 이중 재생 방지
- decodeAudioData 브라우저 호환 래퍼 및 AudioContext 상태 보강(resume)
- 템포 글라이드(Tempo Glide): BPM 변경 시 루프를 멈추지 않고 일정 시간(기본 60-350ms) 동안 자연스럽게 목표 BPM으로 수렴
 - Beat 콜백 동기화: UI의 `currentBeat`는 엔진의 `setOnBeat`로 동기화되어 템포 변경 중에도 1-2-3-4 위상 유지
 - ScrollPicker 실시간 반영: 드래그 중에도 중앙에 걸린 값이 즉시 `onChange`로 반영되어 지연 없는 조작감 제공

## 11. 변경 이력 (v2.2)

### 메트로놈 엔진 개선 - 안정성 강화
- **새로운 Metronome 클래스**: requestAnimationFrame 기반으로 안정적인 타이밍 제공
- **오디오 초기화 개선**: 사용자 상호작용 후 명시적 오디오 초기화
- **중복 재생 방지**: `isStarting` 플래그로 동시 실행 차단
- **상태 관리 강화**: 오디오 준비 상태를 UI에 반영
- **에러 처리 개선**: 각 단계별 에러 핸들링 강화

### UI/UX 개선 - 컴포넌트 분리 (v2.1)
- **MetronomeControls 분리**: 기존 단일 컴포넌트를 두 개로 분리
  - **MetronomeControls**: 메인 화면 컨트롤 (오디오 초기화, 시작/정지, 상태 표시, 설정 버튼)
  - **SettingsBottomSheet**: 설정 전용 바텀시트 (BPM/박자 조절, 탭 템포)
- **1depth 깊은 설정**: 설정 버튼을 통한 세부 조절 기능 접근
- **깔끔한 메인 화면**: 기본 컨트롤만 표시하여 더 깔끔한 UI
- **모바일 친화적**: 바텀시트 형태로 모바일에서 사용하기 편리

### 레이아웃 개선 (v2.0)
- **전체 화면 활용**: 100dvh 높이로 전체 화면 사용
- **헤더 추가**: 상단 고정 헤더 컴포넌트 도입
- **박자 카드 확장**: 전체 화면 크기로 박자 시각화 강화
- **QR 코드 임시 제거**: 현재 주석 처리, 추후 복원 예정

### 색상 시스템 통일
- **gray → neutral**: 모든 회색 계열을 neutral로 통일
- **일관된 색상**: orange.400, neutral.300, neutral.600, neutral.700, neutral.800
- **다크모드 최적화**: 더 나은 대비와 가독성

### BeatCard 컴포넌트 개선
- **Props 단순화**: totalBeats 제거, currentBeat와 isPlaying만 사용
- **전체 화면 크기**: w: full, h: full로 확장
- **Flexbox 중앙 정렬**: 더 정확한 중앙 배치
- **색상 조정**: 일반 박자 색상을 neutral.300으로 변경

### 코드 정리
- **주석 처리**: QR 표시 관련 코드 임시 비활성화
- **Import 정리**: 사용하지 않는 컴포넌트 import 제거
- **Props 최적화**: 불필요한 props 제거로 컴포넌트 단순화
- **컴포넌트 삭제**: 기존 MetronomeControls.tsx 파일 제거

## 모바일 터치 이벤트 최적화 (v3.2)

### 문제 상황
- **PC 환경**: 모든 버튼이 정상 작동
- **모바일 환경**: SettingsBottomSheet의 버튼들이 터치에 반응하지 않음
- **ShareBottomSheet**: 모바일에서 정상 작동

### 원인 분석
1. **이벤트 처리 차이**: PC는 `onClick` 이벤트만으로 충분하지만, 모바일에서는 터치 이벤트가 `onClick`을 제대로 트리거하지 않음
2. **CSS 설정 충돌**: `pointerEvents: 'none'` 설정이 모바일에서 터치 이벤트를 완전히 차단
3. **복잡한 터치 최적화**: 과도한 `touchAction`, `userSelect` 설정이 예상치 못한 충돌 발생

### 해결 방법
#### **1. 이중 이벤트 핸들러 적용**
```typescript
// PC용 onClick + 모바일용 onTouchStart
<Button 
  onClick={() => {
    console.log('버튼 클릭됨');
    onClose();
  }}
  onTouchStart={(e) => {
    console.log('버튼 터치됨');
    e.preventDefault();
    onClose();
  }}
>
```

#### **2. 구조적 단순화**
- **바텀시트 컨테이너**: ShareBottomSheet와 동일한 `insetX: 0` 사용
- **헤더 구조**: 단순한 구조로 변경
- **복잡한 CSS 제거**: `maxH`, `overflow`, `pointerEvents` 등 제거

#### **3. 디버깅 시스템**
- **콘솔 로그**: 각 이벤트 발생 시 로그 출력
- **이벤트 구분**: 클릭과 터치 이벤트를 구분하여 로깅
- **문제 진단**: 모바일에서 어떤 이벤트가 발생하는지 확인 가능

### 적용된 컴포넌트
- **SettingsBottomSheet**: 오버레이, 닫기 버튼, Tab 버튼, 정지 후 설정 버튼
- **모든 버튼**: 이중 이벤트 핸들러로 PC/모바일 호환성 확보

### 결과
- **PC 환경**: 기존과 동일하게 정상 작동
- **모바일 환경**: 모든 버튼이 터치에 정상 반응
- **크로스 플랫폼**: PC와 모바일 모두에서 안정적인 사용자 경험 제공

## 12. 스크롤 피커 성능 최적화 (v3.3)

### 문제점
- **렌더링 성능**: 모든 아이템을 매번 렌더링하여 버벅임 발생
- **메모리 사용량**: 대량의 DOM 노드로 인한 메모리 과다 사용
- **스크롤 지연**: 복잡한 계산과 불필요한 리렌더링으로 인한 성능 저하

### 해결 방법

#### 1. 가상화 (Virtualization)
- **화면 영역 렌더링**: 보이는 아이템만 렌더링 (200개 → 8-10개)
- **동적 범위 계산**: 스크롤 위치에 따라 렌더링 범위 자동 조정
- **패딩 영역**: 상단/하단 패딩으로 자연스러운 스크롤 경험

#### 2. 메모이제이션 (Memoization)
- **값 목록 캐싱**: `useMemo`로 불필요한 재계산 방지
- **선택 인덱스 캐싱**: 현재 선택된 값의 인덱스 메모이제이션
- **중앙 오프셋 캐싱**: 중앙 정렬 계산 결과 캐싱

#### 3. 디바운싱 (Debouncing)
- **onChange 제한**: 60fps로 onChange 호출 제한
- **타이머 관리**: 불필요한 상태 업데이트 방지
- **메모리 누수 방지**: 컴포넌트 언마운트 시 타이머 정리

#### 4. GPU 가속 최적화
- **CSS Transform**: `translate3d(0, 0, 0)`로 GPU 가속 활성화
- **willChange 속성**: 브라우저 최적화 힌트 제공 (드래그 중에만 활성화)
- **하드웨어 가속**: CPU 부하를 GPU로 분산

#### 5. 드래그 최적화 (v3.3.1)
- **onChange 최적화**: 드래그 중에는 onChange 호출하지 않고, 드래그 종료 시에만 호출
- **Transition 비활성화**: 드래그 중에는 CSS transition을 비활성화하여 부드러운 움직임
- **계산 단순화**: 드래그 중에는 opacity와 scale 계산을 단순화하여 성능 향상

### 적용된 컴포넌트
- **ScrollPicker**: BPM 설정용 세로 스크롤 피커
- **HorizontalScrollPicker**: 박자 설정용 가로 스크롤 피커

### 성능 개선 효과
- **렌더링 아이템 수**: 95% 감소 (200개 → 8-10개)
- **메모리 사용량**: 대폭 감소
- **스크롤 성능**: 부드러운 60fps 달성
- **드래그 성능**: 버벅임 없는 자연스러운 BPM 변화
- **사용자 경험**: 매끄러운 스크롤과 즉시 반응하는 드래그

## 13. 스크롤 피커 중앙 정렬 및 색상 개선 (v3.3.2)

### 문제점
- **중앙 정렬 오류**: 스크롤 후 정확히 가운데에 오지 않으면 선택되지 않는 문제
- **색상 문제**: 회색으로 색이 변하여 가독성이 떨어지는 문제
- **선택 상태 불일치**: 드래그 중 선택 상태가 정확히 반영되지 않는 문제

### 해결 방법

#### 1. 정확한 중앙 정렬
- **실시간 중앙 계산**: `currentCenterIndex = Math.round(-offset / itemHeight)`로 정확한 중앙 인덱스 계산
- **직접 오프셋 설정**: `snapToValue` 대신 직접 `setOffset`과 `onChange` 호출
- **정밀한 스냅**: 드래그 종료 시 정확한 오프셋으로 스냅하여 완벽한 중앙 정렬

#### 2. 색상 개선
- **색상 체계 변경**: 회색(`neutral.300`) 대신 흰색(`white`) 사용
- **선택 상태 명확화**: 선택된 값은 오렌지(`orange.400`), 선택되지 않은 값은 흰색
- **가독성 향상**: 더 깔끔하고 명확한 시각적 피드백

#### 3. 실시간 선택 상태 반영
- **동적 선택 계산**: `isSelected = actualIndex === currentCenterIndex`로 실시간 선택 상태 확인
- **드래그 중 시각적 피드백**: 드래그 중에도 현재 중앙 값이 즉시 선택된 상태로 표시
- **일관된 동작**: 세로/가로 스크롤 피커 모두 동일한 로직 적용

### 적용된 컴포넌트
- **ScrollPicker**: BPM 설정용 세로 스크롤 피커
- **HorizontalScrollPicker**: 박자 설정용 가로 스크롤 피커

### 개선 효과
- **정확한 선택**: 스크롤 후 정확히 중앙에 있는 값이 선택됨
- **즉시 반영**: 드래그 중에도 현재 중앙 값이 시각적으로 표시됨
- **깔끔한 UI**: 회색 대신 흰색으로 더 깔끔한 사용자 경험
- **일관된 동작**: 두 스크롤 피커 모두 동일한 정밀한 동작 보장

## 14. 주기적 박자 조정 시스템 (v3.4)

### **문제점**
- 클라이언트 간 미세한 박자 차이가 누적되어 불일치 발생
- 5초 간격 동기화로는 정밀한 박자 조정이 어려움
- 박자 경계에 대한 정확한 동기화 부족

### **해결 방법**
- **다단계 동기화**: 일반 동기화(1초) + 박자 경계 동기화(매 박자마다)
- **정밀한 임계값**: BPM의 10%로 매우 정확한 동기화
- **박자 경계 중심**: 매 박자마다 정확한 타이밍 동기화

### **기술적 구현**
- **서버 측**: `startAdvancedSyncTicker`, `BroadcastBeatSync` 메서드
- **클라이언트 측**: `syncBeatPrecisely` 메서드로 박자 경계 동기화
- **동기화 타입**: `beatSync` 타입으로 박자 동기화 신호 구분

### **성능 개선**
- **동기화 정밀도**: 5초 → 1초 + 매 박자마다 (3-5배 향상)
- **임계값 정밀도**: BPM의 30% → 10% (3배 정밀해짐)
- **박자 정확도**: 박자 경계 중심의 정밀한 동기화

### **적용된 컴포넌트**
- **서버**: `websocket.go` - 다단계 동기화 타이머
- **클라이언트**: `metronome.ts` - 박자 경계 정밀 동기화

### **사용자 경험 개선**
- **완벽한 동기화**: 클라이언트 간 박자 차이가 거의 없어짐
- **안정적인 재생**: 네트워크 지연에도 강건한 동기화
- **자동 조정**: 사용자 개입 없이 자동으로 박자 조정
